class Random{constructor(e){this.jSeed=536870911+e,this.kSeed=8388607+e}random(){var e=Math.floor(this.jSeed/53668);this.jSeed=40014*(this.jSeed-53668*e)-12211*e,this.jSeed<0&&(this.jSeed+=2147483563),e=Math.floor(this.kSeed/52774),this.kSeed=40692*(this.kSeed-52774*e)-3791*e,this.kSeed<0&&(this.kSeed+=2147483399);var t=this.jSeed-this.kSeed;return t<1&&(t+=2147483562),parseFloat(4.65661305739177e-10*parseFloat(t))}}function range(e,t){const a=t-e;return Array.from({length:a},((t,a)=>e+a))}function drop(e,t){if(0==t)return e;if(t>0){for(let a=0;a<t;a++)e.shift();return e}for(let a=0;a>t;a--)e.pop();return e}function windows(e,t,a){return e.map(((e,a,r)=>r.slice(a,a+t))).slice(0,-t+a)}function dot(e,t){return e.map(((a,r)=>e[r]*t[r])).reduce(((e,t)=>e+t))}function generateNoise(e){return r.random()*e}function singletrace(e,t,a,n,i,o,d,l,s){let u=0,c=0,f=n,m="",h=new Object,p=new Array(Math.floor(d/l));function S(e,t){for(;c<e;){for(let e in a)t[f][e]>0?h[e]=-Math.log(r.random())/t[f][e]:h[e]=d+1;let n=d+2;for(let e in a)h[e]<n&&(n=h[e],m=e);if(c+n<e){for(let e=u+1;e<=Math.floor((c+n)/l);e++)p[e]=-o*a[f]+generateNoise(s);f=m,c+=n,u=Math.floor(c/l)}else{for(let t=u+1;t<=Math.floor(e/l);t++)p[t]=-o*a[f]+generateNoise(s);c=e,u=Math.floor(c/l)}}}return p[u]=-o*a[f]+generateNoise(s),S(i,e),S(d,t),p}function tracetable(e,t,a,r,n,i,o,d,l,s){return range(0,i).map((()=>singletrace(e,t,a,r,n,o,d,l,s)))}function addvector(e,t){return e.map(((e,a)=>e+t[a]))}function meancurrent(e,t,a,r,n,i,o,d,l){return tracetable(e,t,a,r,n,i,o,d,l).reduce(((e,t)=>addvector(e,t))).map((e=>e/i))}function meancurrent2(e,t){return e.reduce(((e,t)=>addvector(e,t))).map((e=>e/t))}function filtertest(e,t,a,r,n,i,o,d,l,s){let u=1/l,c=.1325/(s/l),f=Math.round(4*c),m=range(-f,f+1).map((e=>Math.exp(-e*e/(2*c*c))));m=m.map((e=>e/m.reduce(((e,t)=>e+t))));let h=new Array(f).fill(0).concat(meancurrent(t,a,r,n,i,e,o,d+f*u,u).map((t=>t*e)));return{unfilteredCurrent:drop(drop([...h],f),-f),filteredCurrent:windows([...h],1+2*f,1).map((e=>dot(e,m))),timeStep:u}}function peakEPSCs(e,t,a,r,n,i,o,d,l,s,u){let c=range(0,o).map((()=>filtertest(e,t,a,r,n,i,d,l,s,u).filteredCurrent.reduce(((e,t)=>Math.min(e,t))))),f=new Array(Math.round(1.5*-Math.min(...c))).fill(0);return c.forEach((e=>f[-Math.round(e)]++)),f.map((e=>e/f.reduce(((e,t)=>e+t))))}function mean(e){return e.reduce(((e,t)=>e+t))/e.length}function variance(e){let t=mean(e);return mean(e.map((e=>(e-t)*(e-t))))}function standardDeviation(e){return Math.sqrt(variance(e))}function CVdata(e,t,a,r){function n(e,t){return tracetable(t.qflatpulse,t.qPause,t.clist,t.initalState,t.duration,e,t.u,t.maxTime,t.timeStep,t.singlechannelNoise)}let i=[];for(let o=0;o<t;o++){let t=n(e,r);for(let e=0;e<t[0].length;e++){let r=[];for(let n=0;n<t.length;n++)r.push(mean(t[n].slice(e,e+a)));let n=mean(r),o=variance(r);if(void 0===i[n.toFixed(3)])i[n.toFixed(3)]=o;else{const e=i[n.toFixed(3)];i[n.toFixed(3)]=(e+o)/2}}}return Object.keys(i).map((e=>({x:e,y:i[e]})))}onmessage=e=>{e.data.clist=JSON.parse(e.data.clist),r=new Random(e.data.randomSeed),e.data.singletraces=tracetable(e.data.qflatpulse,e.data.qPause,e.data.clist,e.data.initalState,e.data.duration,e.data.n,e.data.u,e.data.maxTime,e.data.timeStep,e.data.singlechannelNoise),e.data.meantrace=meancurrent2(e.data.singletraces,e.data.n),e.data.stderror=standardDeviation(e.data.meantrace)/Math.sqrt(e.data.n),e.data.CVdata=CVdata(e.data.n,e.data.ensembleSize,5,e.data),postMessage(e.data)};
//# sourceMappingURL=worker.e9ef38c3.js.map
